<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>README.md</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>README.md
</h1>
<div class='paths'>
README.md
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2022-03-05 17:09:59 +0100</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Shrine"><a href="https://shrinerb.com">Shrine</a><span><a href="#label-Shrine">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>&lt;img src=“<img src="https://shrinerb.com/img/logo.png" />” width=“100” alt=“Shrine logo: a red paperclip” align=“right” /&gt;</p>

<p><a href="../classes/Shrine.html"><code>Shrine</code></a> is a toolkit for handling file attachments in Ruby applications. Some highlights:</p>
<ul><li>
<p><strong>Modular design</strong> – the <a href="https://shrinerb.com/docs/getting-started#plugin-system">plugin system</a> allows you to load only the functionality you need</p>
</li><li>
<p><strong>Memory friendly</strong> – streaming uploads and <a href="https://shrinerb.com/docs/retrieving-uploads">downloads</a> make it work great with large files</p>
</li><li>
<p><strong>Cloud storage</strong> – store files on <a href="https://shrinerb.com/docs/storage/file-system">disk</a>, <a href="https://shrinerb.com/docs/storage/s3">AWS S3</a>, <a href="https://github.com/renchap/shrine-google_cloud_storage">Google Cloud</a>, <a href="https://github.com/shrinerb/shrine-cloudinary">Cloudinary</a> and others</p>
</li><li>
<p><strong>Persistence integrations</strong> – works with <a href="https://shrinerb.com/docs/plugins/sequel">Sequel</a>, <a href="https://shrinerb.com/docs/plugins/activerecord">ActiveRecord</a>, <a href="https://github.com/shrinerb/shrine-rom">ROM</a>, <a href="https://github.com/katafrakt/hanami-shrine">Hanami</a> and <a href="https://github.com/shrinerb/shrine-mongoid">Mongoid</a> and others</p>
</li><li>
<p><strong>Flexible processing</strong> – generate thumbnails <a href="https://shrinerb.com/docs/getting-started#eager-processing">eagerly</a> or <a href="https://shrinerb.com/docs/getting-started#on-the-fly-processing">on-the-fly</a> using <a href="https://github.com/janko/image_processing/blob/master/doc/minimagick.md#readme">ImageMagick</a> or <a href="https://github.com/janko/image_processing/blob/master/doc/vips.md#readme">libvips</a></p>
</li><li>
<p><strong>Metadata validation</strong> – <a href="https://shrinerb.com/docs/validation">validate files</a> based on <a href="https://shrinerb.com/docs/metadata">extracted metadata</a></p>
</li><li>
<p><strong>Direct uploads</strong> – upload asynchronously <a href="https://shrinerb.com/docs/getting-started#simple-direct-upload">to your app</a> or <a href="https://shrinerb.com/docs/getting-started#presigned-direct-upload">to the cloud</a> using <a href="https://uppy.io/">Uppy</a></p>
</li><li>
<p><strong>Resumable uploads</strong> – make large file uploads <a href="https://shrinerb.com/docs/getting-started#resumable-direct-upload">resumable</a> on <a href="https://github.com/janko/uppy-s3_multipart">S3</a> or <a href="https://github.com/janko/tus-ruby-server">tus</a></p>
</li><li>
<p><strong>Background jobs</strong> – built-in support for <a href="https://shrinerb.com/docs/plugins/backgrounding">background processing</a> that supports <a href="https://github.com/shrinerb/shrine/wiki/Backgrounding-Libraries">any backgrounding library</a></p>
</li></ul>

<p>If you’re curious how it compares to other file attachment libraries, see the <a href="https://shrinerb.com/docs/advantages">Advantages of Shrine</a>. Otherwise, follow along with the <strong>{Getting Started guide}[https://shrinerb.com/docs/getting-started]</strong>.</p>

<h2 id="label-Links">Links<span><a href="#label-Links">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>| Resource | URL | | :—————- | :—————————————————————————– | | Website &amp; Documentation | <a href="https://shrinerb.com">shrinerb.com</a> | | Demo code | <a href="/demo">Roda</a> / <a href="https://github.com/erikdahlstrand/shrine-rails-example">Rails</a> | | Wiki | <a href="https://github.com/shrinerb/shrine/wiki">github.com/shrinerb/shrine/wiki</a> | | Help &amp; Discussion | <a href="https://discourse.shrinerb.com">discourse.shrinerb.com</a> |</p>

<h2 id="label-Setup">Setup<span><a href="#label-Setup">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Add the gem to your Gemfile:</p>

<pre class="ruby"><span class="ruby-comment"># Gemfile</span>&#x000A;<span class="ruby-identifier">gem</span> <span class="ruby-string">&quot;shrine&quot;</span>, <span class="ruby-string">&quot;~&gt; 3.0&quot;</span></pre>

<p>Then add <code>config/initializers/shrine.rb</code> which sets up the storage and loads ORM integration:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&quot;shrine&quot;</span>&#x000A;<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;shrine/storage/file_system&quot;</span>&#x000A;&#x000A;<span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">storages</span> = {&#x000A;  <span class="ruby-value">cache:</span> <span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">FileSystem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;public&quot;</span>, <span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;uploads/cache&quot;</span>), <span class="ruby-comment"># temporary</span>&#x000A;  <span class="ruby-value">store:</span> <span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">FileSystem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;public&quot;</span>, <span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;uploads&quot;</span>),       <span class="ruby-comment"># permanent</span>&#x000A;}&#x000A;&#x000A;<span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:activerecord</span>           <span class="ruby-comment"># loads Active Record integration</span>&#x000A;<span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:cached_attachment_data</span> <span class="ruby-comment"># enables retaining cached file across form redisplays</span>&#x000A;<span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:restore_cached_data</span>    <span class="ruby-comment"># extracts metadata for assigned cached files</span></pre>

<p>Next, add the <code>&lt;name&gt;_data</code> column to the table you want to attach files to. For an “image” attachment on a <code>photos</code> table this would be an <code>image_data</code> column:</p>

<pre>$ rails generate migration add_image_data_to_photos image_data:text # or :jsonb</pre>

<p>If using <code>jsonb</code> consider adding a <a href="https://www.postgresql.org/docs/current/datatype-json.html#JSON-INDEXING">gin index</a> for fast key-value pair searchability within <code>image_data</code>.</p>

<p>Now create an uploader class (which you can put in <code>app/uploaders</code>) and register the attachment on your model:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">ImageUploader</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Shrine</span>&#x000A;  <span class="ruby-comment"># plugins and uploading logic</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Photo</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>&#x000A;  <span class="ruby-identifier">include</span> <span class="ruby-constant">ImageUploader</span><span class="ruby-operator">::</span><span class="ruby-constant">Attachment</span>(<span class="ruby-value">:image</span>) <span class="ruby-comment"># adds an `image` virtual attribute</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>In our views let’s now add form fields for our attachment attribute that will allow users to upload files:</p>

<pre>&lt;%= form_for @photo do |f| %&gt;&#x000A;  &lt;%= f.hidden_field :image, value: @photo.cached_image_data %&gt;&#x000A;  &lt;%= f.file_field :image %&gt;&#x000A;  &lt;%= f.submit %&gt;&#x000A;&lt;% end %&gt;</pre>

<p>When the form is submitted, in your controller you can assign the file from request params to the attachment attribute on the model:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">PhotosController</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ApplicationController</span>&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create</span>&#x000A;    <span class="ruby-constant">Photo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">photo_params</span>) <span class="ruby-comment"># attaches the uploaded file</span>&#x000A;    <span class="ruby-comment"># ...</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">private</span>&#x000A;&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">photo_params</span>&#x000A;    <span class="ruby-identifier">params</span>.<span class="ruby-identifier">require</span>(<span class="ruby-value">:photo</span>).<span class="ruby-identifier">permit</span>(<span class="ruby-value">:image</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>Once a file is uploaded and attached to the record, you can retrieve the file URL and display it on the page:</p>

<pre>&lt;%= image_tag @photo.image_url %&gt;</pre>

<p>See the <strong>{Getting Started guide}[https://shrinerb.com/docs/getting-started]</strong> for further documentation.</p>

<h2 id="label-Inspiration">Inspiration<span><a href="#label-Inspiration">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="../classes/Shrine.html"><code>Shrine</code></a> was heavily inspired by <a href="https://github.com/refile/refile">Refile</a> and <a href="https://github.com/jeremyevans/roda">Roda</a>. From Refile it borrows the idea of “backends” (here named “storages”), attachment interface, and direct uploads. From Roda it borrows the implementation of an extensible plugin system.</p>

<h2 id="label-Similar+libraries">Similar libraries<span><a href="#label-Similar+libraries">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p>Paperclip</p>
</li><li>
<p>CarrierWave</p>
</li><li>
<p>Dragonfly</p>
</li><li>
<p>Refile</p>
</li><li>
<p>Active Storage</p>
</li></ul>

<h2 id="label-Contributing">Contributing<span><a href="#label-Contributing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Please refer to the <a href="https://github.com/shrinerb/shrine/blob/master/CONTRIBUTING.md">contributing page</a>.</p>

<h2 id="label-Code+of+Conduct">Code of Conduct<span><a href="#label-Code+of+Conduct">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Everyone interacting in the <a href="../classes/Shrine.html"><code>Shrine</code></a> project’s codebases, issue trackers, and mailing lists is expected to follow the <a href="/CODE_OF_CONDUCT_md.html">Shrine code of conduct</a>.</p>

<h2 id="label-License">License<span><a href="#label-License">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The gem is available as open source under the terms of the <a href="/LICENSE.txt">MIT License</a>.</p>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
