<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Shrine 2.7.0 · Shrine</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## New Plugins"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Shrine 2.7.0 · Shrine"/><meta property="og:type" content="website"/><meta property="og:url" content="https://shrinerb.com/"/><meta property="og:description" content="## New Plugins"/><meta property="og:image" content="https://shrinerb.com/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://shrinerb.com/img/logo.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-149836844-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/version.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="Shrine"/><h2 class="headerTitleWithLogo">Shrine</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/getting-started" target="_self">Guides</a></li><li class=""><a href="/docs/plugins/activerecord" target="_self">Plugins</a></li><li class=""><a href="/docs/external/extensions" target="_self">External</a></li><li class=""><a href="https://discourse.shrinerb.com" target="_blank">Discourse</a></li><li class=""><a href="https://github.com/shrinerb/shrine" target="_blank">GitHub</a></li><li class=""><a href="https://github.com/shrinerb/shrine/wiki" target="_blank">Wiki</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Shrine 2.x</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Shrine 3.x</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/release_notes/3.4.0">Shrine 3.4.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/3.3.0">Shrine 3.3.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/3.2.2">Shrine 3.2.2</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/3.2.1">Shrine 3.2.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/3.2.0">Shrine 3.2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/3.1.0">Shrine 3.1.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/3.0.1">Shrine 3.0.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/3.0.0">Shrine 3.0.0</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Shrine 2.x</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.19.0">Shrine 2.19.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.18.0">Shrine 2.18.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.17.0">Shrine 2.17.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.16.0">Shrine 2.16.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.15.0">Shrine 2.15.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.14.0">Shrine 2.14.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.13.0">Shrine 2.13.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.12.0">Shrine 2.12.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.11.0">Shrine 2.11.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.10.1">Shrine 2.10.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.10.0">Shrine 2.10.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.9.0">Shrine 2.9.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.8.0">Shrine 2.8.0</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/release_notes/2.7.0">Shrine 2.7.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.6.1">Shrine 2.6.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.6.0">Shrine 2.6.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.5.0">Shrine 2.5.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.4.1">Shrine 2.4.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.4.0">Shrine 2.4.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.3.1">Shrine 2.3.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.3.0">Shrine 2.3.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.2.0">Shrine 2.2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.1.1">Shrine 2.1.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.1.0">Shrine 2.1.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.0.1">Shrine 2.0.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/2.0.0">Shrine 2.0.0</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Shrine 1.x</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/release_notes/1.4.2">Shrine 1.4.2</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/1.4.1">Shrine 1.4.1</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/1.4.0">Shrine 1.4.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/1.3.0">Shrine 1.3.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/1.2.0">Shrine 1.2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/1.1.0">Shrine 1.1.0</a></li><li class="navListItem"><a class="navItem" href="/docs/release_notes/1.0.0">Shrine 1.0.0</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/shrinerb/shrine/edit/master/doc/release_notes/2.7.0.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Shrine 2.7.0</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="new-plugins"></a><a href="#new-plugins" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>New Plugins</h2>
<ul>
<li>The <code>direct_upload</code> plugin has been split into <code>upload_endpoint</code> and
<code>presign_endpoint</code> plugins. These plugins provide respective endpoints that
accept requests to the root URL, allowing users to fully choose the URL. They
also drop the Roda dependency.</li>
</ul>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby">Shrine</span><span class="punctuation separator method ruby">.</span>plugin&nbsp;<span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>upload_endpoint</span></span></div><div class="line"><span class="source ruby">&nbsp;</span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;config.ru&nbsp;</span></span></div><div class="line"><span class="source ruby">map&nbsp;<span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby">&quot;</span>/images/upload<span class="punctuation definition string end ruby">&quot;</span></span>&nbsp;<span class="keyword control start-block ruby">do</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;run&nbsp;<span class="support class ruby">ImageUploader</span><span class="punctuation separator method ruby">.</span>upload_endpoint<span class="punctuation section function ruby">(</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>cache</span><span class="punctuation section function ruby">)</span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby">end</span>&nbsp;<span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;creates&nbsp;a&nbsp;`POST&nbsp;/images/upload`&nbsp;endpoint&nbsp;</span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby">Shrine</span><span class="punctuation separator method ruby">.</span>plugin&nbsp;<span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>presign_endpoint</span></span></div><div class="line"><span class="source ruby">&nbsp;</span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;config.ru&nbsp;</span></span></div><div class="line"><span class="source ruby">map&nbsp;<span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby">&quot;</span>/presign<span class="punctuation definition string end ruby">&quot;</span></span>&nbsp;<span class="keyword control start-block ruby">do</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;run&nbsp;<span class="support class ruby">Shrine</span><span class="punctuation separator method ruby">.</span>presign_endpoint<span class="punctuation section function ruby">(</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>cache</span><span class="punctuation section function ruby">)</span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby">end</span>&nbsp;<span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;creates&nbsp;a&nbsp;`GET&nbsp;/presign`&nbsp;endpoint&nbsp;</span></span></div></code></pre>
<ul>
<li>The <code>rack_response</code> plugin has been extracted from <code>download_endpoint</code>. It
gives the ability to convert a <code>Shrine::UploadedFile</code> object into a Rack
response triple.</li>
</ul>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby">Shrine</span><span class="punctuation separator method ruby">.</span>plugin&nbsp;<span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>rack_response</span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby">class</span>&nbsp;<span class="entity name type class ruby">FilesController<span class="entity other inherited-class ruby">&nbsp;<span class="punctuation separator inheritance ruby">&lt;</span>&nbsp;ActionController::Base</span></span></span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;<span class="meta function method without-arguments ruby"><span class="keyword control def ruby">def</span>&nbsp;<span class="entity name function ruby">download</span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;...&nbsp;</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;&nbsp;&nbsp;file_response&nbsp;<span class="keyword operator assignment ruby">=</span>&nbsp;record<span class="punctuation separator method ruby">.</span>attachment<span class="punctuation separator method ruby">.</span>to_rack_response&nbsp;<span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;returns&nbsp;a&nbsp;Rack&nbsp;response&nbsp;triple&nbsp;</span></span></div><div class="line"><span class="source ruby">&nbsp;</span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;&nbsp;&nbsp;response<span class="punctuation separator method ruby">.</span>status&nbsp;<span class="keyword operator assignment ruby">=</span>&nbsp;file_response<span class="punctuation section array begin ruby">[</span><span class="constant numeric ruby">0</span><span class="punctuation section array end ruby">]</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;&nbsp;&nbsp;response<span class="punctuation separator method ruby">.</span>headers<span class="punctuation separator method ruby">.</span>merge!<span class="punctuation section function ruby">(</span>file_response<span class="punctuation section array begin ruby">[</span><span class="constant numeric ruby">1</span><span class="punctuation section array end ruby">]</span><span class="punctuation section function ruby">)</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;&nbsp;&nbsp;<span class="variable language self ruby">self</span><span class="punctuation separator method ruby">.</span>response_body&nbsp;<span class="keyword operator assignment ruby">=</span>&nbsp;file_response<span class="punctuation section array begin ruby">[</span><span class="constant numeric ruby">2</span><span class="punctuation section array end ruby">]</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;<span class="keyword control ruby">end</span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby">end</span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="new-features"></a><a href="#new-features" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>New Features</h2>
<ul>
<li>The <code>determine_mime_type</code> plugin now supports the <a href="https://github.com/discourse/mini_mime">mini_mime</a> gem for
determining the MIME type from file extension. The mini_mime gem is aimed to
be a lightweight replacement for the <a href="https://github.com/mime-types/ruby-mime-types">mime-types</a> gem.</li>
</ul>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby">Shrine</span><span class="punctuation separator method ruby">.</span>plugin&nbsp;<span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>determine_mime_type</span><span class="punctuation separator object ruby">,</span>&nbsp;<span class="constant other symbol hashkey ruby">analyzer<span class="punctuation definition constant ruby">:</span></span>&nbsp;<span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>mini_mime</span></span></div></code></pre>
<ul>
<li><code>Shrine::Attachment.new</code> now accepts additional options that are forwarded to
<code>Shrine::Attacher.new</code>. This allows for overriding temporary and permanent
storages per attachment declaration.</li>
</ul>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby">class</span>&nbsp;<span class="entity name type class ruby">Photo</span></span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;<span class="keyword other special-method ruby">include</span>&nbsp;<span class="support class ruby">ImageUploader</span><span class="punctuation separator other ruby">::</span><span class="support class ruby">Attachment</span><span class="punctuation separator method ruby">.</span><span class="keyword other special-method ruby">new</span><span class="punctuation section function ruby">(</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>image</span><span class="punctuation separator object ruby">,</span>&nbsp;<span class="constant other symbol hashkey ruby">cache<span class="punctuation definition constant ruby">:</span></span>&nbsp;<span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>other_cache</span><span class="punctuation separator object ruby">,</span>&nbsp;<span class="constant other symbol hashkey ruby">store<span class="punctuation definition constant ruby">:</span></span>&nbsp;<span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>other_store</span><span class="punctuation section function ruby">)</span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby">end</span></span></div></code></pre>
<ul>
<li>The <code>activerecord</code> plugin now allows validation error messages to be an
array, which is passed as arguments to <code>record.errors.add</code>. This allows users
to delegate validation error message generation and i18n to ActiveRecord.</li>
</ul>
<pre><code class="language-rb"><div class="line"><span class="source ruby">validate_max_size&nbsp;<span class="constant numeric ruby">256</span>&nbsp;<span class="keyword operator arithmetic ruby">*</span>&nbsp;<span class="constant numeric ruby">1024</span><span class="keyword operator arithmetic ruby">**</span><span class="constant numeric ruby">2</span><span class="punctuation separator object ruby">,</span>&nbsp;<span class="constant other symbol hashkey ruby">message<span class="punctuation definition constant ruby">:</span></span>&nbsp;<span class="keyword operator arithmetic ruby">-</span><span class="keyword operator comparison ruby">&gt;</span>&nbsp;<span class="punctuation section function ruby">(</span>max<span class="punctuation section function ruby">)</span>&nbsp;<span class="punctuation section scope begin ruby">{</span><span class="meta syntax ruby start-block">&nbsp;</span><span class="punctuation section array begin ruby">[</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby">:</span>too_large</span><span class="punctuation separator object ruby">,</span>&nbsp;<span class="constant other symbol hashkey ruby">max<span class="punctuation definition constant ruby">:</span></span>&nbsp;max<span class="punctuation section array end ruby">]</span>&nbsp;<span class="punctuation section scope end ruby">}</span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="other-improvements"></a><a href="#other-improvements" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other Improvements</h2>
<ul>
<li><code>Shrine::Storage::S3</code> now supports the new <code>aws-sdk-s3</code> gem. See the <a href="https://aws.amazon.com/blogs/developer/aws-sdk-for-ruby-modularization-version-3-2/">AWS
announcement</a> for more details on the modularization of the <code>aws-sdk</code> gem.</li>
</ul>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta require ruby"><span class="keyword other special-method ruby">gem</span>&nbsp;<span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby">&quot;</span>aws-sdk-s3<span class="punctuation definition string end ruby">&quot;</span></span><span class="punctuation separator object ruby">,</span>&nbsp;<span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby">&quot;</span>~&gt;&nbsp;1.2<span class="punctuation definition string end ruby">&quot;</span></span></span></span></div></code></pre>
<ul>
<li><p><code>Shrine::Storage::S3#open</code> now uses streaming with the <code>aws-sdk-s3</code> gem
instead of <code>Down</code>. Previously this discrepancy would cause <code>aws-sdk-s3</code>
options like <code>:proxy</code> to not have any effect in <code>Shrine::Storage::S3#open</code>.</p></li>
<li><p><code>Shrine::Storage::S3</code> now raises an <code>ArgumentError</code> when <code>:bucket</code> option is
<code>nil</code>.</p></li>
<li><p>A Shrine uploader can now call file validations from its superclass.</p></li>
</ul>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby">class</span>&nbsp;<span class="entity name type class ruby">ImageUploader<span class="entity other inherited-class ruby">&nbsp;<span class="punctuation separator inheritance ruby">&lt;</span>&nbsp;Shrine</span></span></span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;<span class="support class ruby">Attacher</span><span class="punctuation separator method ruby">.</span>validate&nbsp;<span class="keyword control start-block ruby">do</span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;...&nbsp;</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;<span class="keyword control ruby">end</span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby">end</span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby">class</span>&nbsp;<span class="entity name type class ruby">ProfileImageUploader<span class="entity other inherited-class ruby">&nbsp;<span class="punctuation separator inheritance ruby">&lt;</span>&nbsp;ImageUploader</span></span></span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;<span class="support class ruby">Attacher</span><span class="punctuation separator method ruby">.</span>validate&nbsp;<span class="keyword control start-block ruby">do</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword control pseudo-method ruby">super</span><span class="punctuation section function ruby">()</span>&nbsp;<span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;empty&nbsp;parentheses&nbsp;are&nbsp;required&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby">#</span>&nbsp;...&nbsp;</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;<span class="keyword control ruby">end</span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby">end</span></span></div></code></pre>
<ul>
<li><p>The <code>download_endpoint</code> now encodes uploaded file metadata in the URL,
allowing it to use them when generating a file response. Now the <code>filename</code>
metadata will be used for <code>Content-Disposition</code> if available. Also, the
<code>mime_type</code> metadata will be used for <code>Content-Type</code> instead of <code>Rack::Mime</code>
when available.</p></li>
<li><p>The <code>download_endpoint</code> now returns a <code>404 Not Found</code> when uploaded file is
missing.</p></li>
<li><p>The <code>download_endpoint</code> now returns <code>Cache-Control: max-age=31536000</code> header
which tells clients to cache the response for 1 year.</p></li>
<li><p>The <code>download_endpoint</code> now uses <code>Rack::BodyProxy</code> instead of Roda's
<code>streaming</code> plugin, which means the <code>download_endpoint</code> plugin loads less
code in total.</p></li>
<li><p>Fixed <code>determine_mime_type</code> plugin raising an exception when empty files are
given to <code>file</code> or <code>filemagic</code> analyzers.</p></li>
<li><p>Un-deprecated <code>Shrine.uploaded_file</code> accepting file data as JSON string.</p></li>
<li><p>The <code>Shrine::UploadedFile#base64</code> and <code>Shrine::UploadedFile#data_uri</code> methods
from the <code>data_uri</code> plugin don't wrap the base64-encoded content to 60
columns anymore.</p></li>
<li><p>The <code>signature</code> plugin doesn't wrap base64-formatted signatures to 60 columns
anymore.</p></li>
<li><p>The <code>signature</code> plugin doesn't add a newline at the end of the base64-formatted
signature anymore.</p></li>
<li><p>The <code>data_uri</code> plugin doesn't raise an exception on Ruby 2.4.1 on raw data URIs
anymore.</p></li>
<li><p>Reduce model pollution by eliminating the need for an internal
<code>@@&lt;attachment&gt;_attacher_class</code> class variable.</p></li>
<li><p>Fixed <code>direct_upload</code> plugin printing a deprecation warning when generating
fake presigns when query parameters are passed in.</p></li>
<li><p>Update Down dependency to the latest <code>4.x</code> version.</p></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="backwards-compatibility"></a><a href="#backwards-compatibility" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Backwards compatibility</h2>
<ul>
<li><p>With the release of <code>upload_endpoint</code> and <code>presign_endpoint</code> plugins, the
<code>direct_upload</code> plugin should now be considered deprecated. It will be
officially deprecated in Shrine 3, and removed in Shrine 4.</p></li>
<li><p>The <code>Shrine::DownloadEndpoint</code> constant has been deprecated over the
<code>Shrine.download_endpoint</code> method, and it will be removed in Shrine 3. In
Shrine 3 the returned app won't be a <code>Roda</code> subclass anymore, instead it will
be a pure Rack class. If you are relying on this, you should update your code.
For example, if you were using <code>Roda.use</code> to add middlewares, you can instead
wrap the endpoint in the middlewares directly:</p></li>
</ul>
<pre><code class="language-rb"><div class="line"><span class="source ruby">map&nbsp;<span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby">&quot;</span>/attachments<span class="punctuation definition string end ruby">&quot;</span></span>&nbsp;<span class="keyword control start-block ruby">do</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;use&nbsp;<span class="variable other constant ruby">MyMiddleware</span></span></div><div class="line"><span class="source ruby">&nbsp;&nbsp;run&nbsp;<span class="support class ruby">Shrine</span><span class="punctuation separator method ruby">.</span>download_endpoint</span></div><div class="line"><span class="source ruby"><span class="keyword control ruby">end</span></span></div></code></pre>
<ul>
<li>The <code>download_endpoint</code> doesn't generate URLs which end with uploaded file ID
anymore; instead it generates URLs with base64-encoded uploaded file data.
The old URLs will remain supported indefinitely. If you were relying on URLs
including uploaded file ID, you'll need to update your code. If this was
becase you wanted to authenticate <code>download_endpoint</code> requests, you should
probably use the new <code>rack_response</code> plugin instead of <code>download_endpoint</code>.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/release_notes/2.8.0"><span class="arrow-prev">← </span><span>Shrine 2.8.0</span></a><a class="docs-next button" href="/docs/release_notes/2.6.1"><span>Shrine 2.6.1</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#new-plugins">New Plugins</a></li><li><a href="#new-features">New Features</a></li><li><a href="#other-improvements">Other Improvements</a></li><li><a href="#backwards-compatibility">Backwards compatibility</a></li></ul></nav></div><footer class="nav-footer" id="footer" data-version="3.4.0"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.png" alt="Shrine" width="66"/></a><div><h5>Docs</h5><a href="/guides">Guides</a><a href="/plugins">Plugins</a><a href="/external">External</a><a href="https://github.com/shrinerb/shrine/blob/master/CONTRIBUTING.md#readme">Contributing</a></div><div><h5>Community</h5><a href="https://discourse.shrinerb.com" target="_blank" rel="noreferrer noopener">Discourse</a><a href="https://stackoverflow.com/questions/tagged/shrine" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://twin.github.io">Blog</a><a href="https://github.com/shrinerb/shrine">GitHub</a><a class="github-button" href="https://github.com/shrinerb/shrine" data-icon="octicon-star" data-count-href="/shrinerb/shrine/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/shrine_rb" class="twitter-follow-button">Follow @shrine_rb</a></div></div></section><section class="copyright">Copyright © 2022 Janko Marohnić</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '09a11b10801874df7d226df4f2ce8e8f',
                indexName: 'shrinerb',
                inputSelector: '#search_input_react'
              });
            </script></body></html>